# 虚拟仓库优化实施方案

## 一、现状分析
1. 当前问题：
   - 采购/生产入库数据分离管理
   - 缺乏实时库存状态跟踪
   - 物流发货依赖人工核对库存

## 二、优化目标
1. 建立统一的虚拟库存管理体系
2. 实现入库-库存-出库全流程状态跟踪
3. 减少人工干预环节

## 三、具体实施方案

### 1. 数据库改造
```sql:x%3A%5Cdemo%5Csql%5Cvirtual_warehouse_ddl.sql
-- 新增虚拟仓库主表
CREATE TABLE virtual_warehouse (
    id INT PRIMARY KEY AUTO_INCREMENT,
    material_id VARCHAR(50) NOT NULL,
    material_name VARCHAR(100) NOT NULL,
    batch_no VARCHAR(50) NOT NULL,
    quantity DECIMAL(12,2) NOT NULL,
    status ENUM('IN_TRANSIT','PENDING_CHECK','QUALIFIED','REJECTED') NOT NULL,
    source_type ENUM('PURCHASE','PRODUCTION') NOT NULL,
    source_id INT NOT NULL COMMENT '采购单ID/生产单ID',
    check_result TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 新增库存状态变更日志表
CREATE TABLE inventory_status_log (
    id INT PRIMARY KEY AUTO_INCREMENT,
    inventory_id INT NOT NULL,
    from_status VARCHAR(50),
    to_status VARCHAR(50) NOT NULL,
    operator VARCHAR(50) NOT NULL,
    remark TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);